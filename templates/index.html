<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertisseur de Coordonn√©es GNSS RTK</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Convertisseur de Coordonn√©es GNSS RTK</h1>
            <p>Conversion pr√©cise entre syst√®mes de r√©f√©rence avec support g√©o√Øde</p>
        </div>

        <div class="content">
            
            <!-- √âtape 1: Import du fichier -->
            <div class="step" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">Importer le fichier CSV</div>
                </div>
                
                <div class="file-upload" id="fileUploadZone">
                    <div class="file-upload-icon">üìÅ</div>
                    <div class="file-upload-text">Glissez-d√©posez votre fichier CSV ici</div>
                    <div class="file-upload-hint">ou cliquez pour parcourir (CSV, TXT)</div>
                    <input type="file" id="fileInput" accept=".csv,.txt" style="display: none;">
                    <button class="btn-browse" onclick="document.getElementById('fileInput').click()">
                        Parcourir
                    </button>
                </div>

                <div class="preview-box" id="filePreview">
                    <div class="preview-title">üìä Aper√ßu du fichier (5 premi√®res lignes)</div>
                    <div class="preview-content" id="previewContent"></div>
                    <div id="fileInfo" style="margin-top: 15px;"></div>
                </div>

                <div class="format-selector" id="formatSelector" style="display: none;">
                    <div class="preview-title">Format des coordonn√©es</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="formatLatLong" name="coordFormat" value="lat_long_h" checked>
                            <label for="formatLatLong">Matricule, Latitude, Longitude, h</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="formatLongLat" name="coordFormat" value="long_lat_h">
                            <label for="formatLongLat">Matricule, Longitude, Latitude, h</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="formatXYZ" name="coordFormat" value="x_y_z">
                            <label for="formatXYZ">Matricule, X, Y, Z (coordonn√©es projet√©es)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- √âtape 2: Syst√®me source -->
            <div class="step" id="step2" style="display: none;">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">Syst√®me de coordonn√©es source</div>
                </div>
                
                <!-- Info d√©tection -->
                <div id="detectionInfoSource"></div>
                
                <!-- S√©lecteur de r√©gion -->
                <div class="region-selector">
                    <label class="region-label">R√©gion / Pays :</label>
                    <select class="select-box" id="regionSource">
                        <option value="">-- S√©lectionner une r√©gion --</option>
                    </select>
                </div>
                
                <!-- üÜï BOUTON D√âTECTION INTELLIGENTE -->
                <div id="autoDetectContainer" style="display: none; margin: 20px 0;">
                    <button class="btn-auto-detect" id="btnAutoDetect">
                        üîç D√©tection automatique des syst√®mes compatibles
                    </button>
                    <div class="info-badge" style="margin-top: 10px;">
                        üí° Laissez l'application tester automatiquement tous les syst√®mes de la r√©gion pour trouver ceux compatibles avec vos coordonn√©es
                    </div>
                </div>
                
                <!-- Menu d√©roulant EPSG -->
                <div class="region-selector">
                    <label class="region-label">Syst√®me de coordonn√©es :</label>
                    <select class="select-box" id="sourceEpsg">
                        <option value="">-- S√©lectionner d'abord une r√©gion --</option>
                    </select>
                </div>
                
                <!-- Bouton de validation (visible seulement si coords projet√©es) -->
                <div id="validateSourceContainer" style="display: none;">
                    <button class="validate-button" id="btnValidateSource">
                        ‚úî Valider le syst√®me source
                    </button>
                </div>
                
                <div id="regionInfoSource"></div>
            </div>

            <!-- √âtape 3: Syst√®me cible -->
            <div class="step" id="step3" style="display: none;">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Syst√®me de coordonn√©es cible</div>
                </div>
                
                <!-- Suggestions AVANT -->
                <div id="suggestionInfoTarget"></div>
                
                <!-- Info d√©tection -->
                <div id="detectionInfoTarget"></div>
                
                <!-- S√©lecteur de r√©gion -->
                <div class="region-selector">
                    <label class="region-label">R√©gion / Pays :</label>
                    <select class="select-box" id="regionTarget">
                        <option value="">-- S√©lectionner une r√©gion --</option>
                    </select>
                </div>
                
                <!-- Menu d√©roulant EPSG -->
                <div class="region-selector">
                    <label class="region-label">Syst√®me de coordonn√©es :</label>
                    <select class="select-box" id="targetEpsg">
                        <option value="">-- S√©lectionner d'abord une r√©gion --</option>
                    </select>
                </div>
                
                <div id="regionInfoTarget"></div>
            </div>

            <!-- √âtape 4: G√©o√Øde -->
            <div class="step" id="step4" style="display: none;">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">Mod√®le de g√©o√Øde (conversion h ‚Üí H)</div>
                </div>
                
                <select class="select-box" id="geoidSelect">
                    {% for code, name in geoid_list.items() %}
                        <option value="{{ code }}">{{ name }}</option>
                    {% endfor %}
                </select>
                
                <div id="geoidInfo"></div>
            </div>

            <!-- √âtape 5: Conversion -->
            <div class="step" id="step5" style="display: none;">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">Lancer la conversion</div>
                </div>
                
                <button class="btn-convert" id="btnConvert">
                    üöÄ Convertir les coordonn√©es
                </button>
                
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill"></div>
                </div>
            </div>

            <!-- R√©sultats -->
            <div class="step" id="stepResults" style="display: none;">
                <div class="step-header">
                    <div class="step-number">‚úî</div>
                    <div class="step-title">R√©sultats</div>
                </div>
                
                <div class="preview-box show">
                    <div class="preview-title">üìä Aper√ßu des coordonn√©es converties (5 premi√®res lignes)</div>
                    <div class="preview-content" id="resultsPreview"></div>
                </div>
                
                <button class="btn-export" id="btnExport">
                    üì• T√©l√©charger le CSV complet
                </button>
                
                <button class="btn-reset" id="btnReset">
                    üîÑ Nouvelle conversion
                </button>
            </div>

        </div>
    </div>

    <!-- Stocker la base EPSG en JavaScript -->
    <script>
        window.EPSG_DATABASE = {{ epsg_database | tojson }};
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>